{"version":3,"file":"array.js","sources":["../../../src/-private/new/array.ts"],"sourcesContent":["import { trackedArray } from '@ember/reactive/collections';\n\n// Old TrackedArray dirtied all values on change, regardless of whether the value\n// actually changed.\nconst config = {\n  equals: () => false,\n  description: 'TrackedArray from tracked-built-ins',\n};\n\nexport class TrackedArray {\n  static from(iterable: any, mapfn: any, thisArg?: any) {\n    return mapfn\n      ? new TrackedArray(Array.from(iterable, mapfn, thisArg))\n      : new TrackedArray(Array.from(iterable));\n  }\n\n  static of(...arr: unknown[]) {\n    return new TrackedArray(arr);\n  }\n  constructor(arr: unknown[] = []) {\n    const reactive = trackedArray(arr, config);\n\n    const boundFns = new WeakMap();\n\n    function call(\n      target: object,\n      receiver: object,\n      fn: (...args: unknown[]) => unknown,\n    ) {\n      let existing = boundFns.get(fn);\n\n      if (!existing) {\n        existing = (...args: unknown[]) => {\n          const result = fn.apply(target, args);\n\n          if (result === reactive) {\n            return receiver;\n          }\n\n          return result;\n        };\n        boundFns.set(fn, existing);\n      }\n\n      return existing;\n    }\n\n    return new Proxy(reactive, {\n      get(target, prop, receiver) {\n        const value = Reflect.get(target, prop, target);\n\n        if (typeof value === 'function') {\n          return call(target, receiver, value);\n        }\n\n        return value;\n      },\n      getPrototypeOf() {\n        return TrackedArray.prototype;\n      },\n    });\n  }\n}\n// Ensure instanceof works correctly\nObject.setPrototypeOf(TrackedArray.prototype, Array.prototype);\n"],"names":["config","equals","description","TrackedArray","from","iterable","mapfn","thisArg","Array","of","arr","constructor","reactive","trackedArray","boundFns","WeakMap","call","target","receiver","fn","existing","get","args","result","apply","set","Proxy","prop","value","Reflect","getPrototypeOf","prototype","Object","setPrototypeOf"],"mappings":";;AAEA;AACA;AACA,MAAMA,MAAM,GAAG;EACbC,MAAM,EAAEA,MAAM,KAAK;AACnBC,EAAAA,WAAW,EAAE;AACf,CAAC;AAEM,MAAMC,YAAY,CAAC;AACxB,EAAA,OAAOC,IAAIA,CAACC,QAAa,EAAEC,KAAU,EAAEC,OAAa,EAAE;IACpD,OAAOD,KAAK,GACR,IAAIH,YAAY,CAACK,KAAK,CAACJ,IAAI,CAACC,QAAQ,EAAEC,KAAK,EAAEC,OAAO,CAAC,CAAC,GACtD,IAAIJ,YAAY,CAACK,KAAK,CAACJ,IAAI,CAACC,QAAQ,CAAC,CAAC;AAC5C,EAAA;AAEA,EAAA,OAAOI,EAAEA,CAAC,GAAGC,GAAc,EAAE;AAC3B,IAAA,OAAO,IAAIP,YAAY,CAACO,GAAG,CAAC;AAC9B,EAAA;AACAC,EAAAA,WAAWA,CAACD,GAAc,GAAG,EAAE,EAAE;AAC/B,IAAA,MAAME,QAAQ,GAAGC,YAAY,CAACH,GAAG,EAAEV,MAAM,CAAC;AAE1C,IAAA,MAAMc,QAAQ,GAAG,IAAIC,OAAO,EAAE;AAE9B,IAAA,SAASC,IAAIA,CACXC,MAAc,EACdC,QAAgB,EAChBC,EAAmC,EACnC;AACA,MAAA,IAAIC,QAAQ,GAAGN,QAAQ,CAACO,GAAG,CAACF,EAAE,CAAC;MAE/B,IAAI,CAACC,QAAQ,EAAE;AACbA,QAAAA,QAAQ,GAAGA,CAAC,GAAGE,IAAe,KAAK;UACjC,MAAMC,MAAM,GAAGJ,EAAE,CAACK,KAAK,CAACP,MAAM,EAAEK,IAAI,CAAC;UAErC,IAAIC,MAAM,KAAKX,QAAQ,EAAE;AACvB,YAAA,OAAOM,QAAQ;AACjB,UAAA;AAEA,UAAA,OAAOK,MAAM;QACf,CAAC;AACDT,QAAAA,QAAQ,CAACW,GAAG,CAACN,EAAE,EAAEC,QAAQ,CAAC;AAC5B,MAAA;AAEA,MAAA,OAAOA,QAAQ;AACjB,IAAA;AAEA,IAAA,OAAO,IAAIM,KAAK,CAACd,QAAQ,EAAE;AACzBS,MAAAA,GAAGA,CAACJ,MAAM,EAAEU,IAAI,EAAET,QAAQ,EAAE;QAC1B,MAAMU,KAAK,GAAGC,OAAO,CAACR,GAAG,CAACJ,MAAM,EAAEU,IAAI,EAAEV,MAAM,CAAC;AAE/C,QAAA,IAAI,OAAOW,KAAK,KAAK,UAAU,EAAE;AAC/B,UAAA,OAAOZ,IAAI,CAACC,MAAM,EAAEC,QAAQ,EAAEU,KAAK,CAAC;AACtC,QAAA;AAEA,QAAA,OAAOA,KAAK;MACd,CAAC;AACDE,MAAAA,cAAcA,GAAG;QACf,OAAO3B,YAAY,CAAC4B,SAAS;AAC/B,MAAA;AACF,KAAC,CAAC;AACJ,EAAA;AACF;AACA;AACAC,MAAM,CAACC,cAAc,CAAC9B,YAAY,CAAC4B,SAAS,EAAEvB,KAAK,CAACuB,SAAS,CAAC;;;;"}